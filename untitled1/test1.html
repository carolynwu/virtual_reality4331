<html>
<head>
    <title>Example 10.02 - Bump maps</title>
    <script src="js/aframe.min.js"></script>
    <script src="js/sky.js"></script>
    <!--<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v1.14.0/dist/aframe-extras.min.js"></script>-->
</head>

<body >
<a-scene>

    <script>
        AFRAME.registerComponent('sun-position-setter', {
            init: function () {
                var skyEl = this.el;
                var orbitEl = this.el.sceneEl.querySelector('#orbit');

                orbitEl.addEventListener('componentchanged', function changeSun (evt) {
                    var sunPosition;
                    var phi;
                    var theta;

                    if (evt.detail.name !== 'rotation') { return; }

                    sunPosition = orbitEl.getAttribute('rotation');

                    if(sunPosition === null) { return; }

                    theta = Math.PI * (- 0.5);
                    phi = 2 * Math.PI * (sunPosition.y / 360 - 0.5);
                    //Debugging position
                    console.log(Math.cos(phi), Math.sin(phi) * Math.sin(theta))
                    skyEl.setAttribute('material', 'sunPosition', {
                        x: Math.cos(phi),
                        y: Math.sin(phi) * Math.sin(theta),
                        z: -1
                    });
                });
            }
        });
    </script>

    <a-assets>
        <audio id="blip1" src="images/horned_owl.wav"></audio>
    </a-assets>

    <a-entity>
        <a-camera universal-controls="" wasd-controls="acceleration:400" position="0 1.6 0" rotation="10.542423430407148 175.32508531003194 0" camera="" look-controls="" data-aframe-inspector-original-camera="">
            <a-entity raycaster="far:150;objects:.intersectable" cursor="" geometry="primitive:ring;radiusOuter:0.015;radiusInner:0.01" material="color:#283644;shader:flat"></a-entity>
        </a-camera>
    </a-entity>

    <a-entity id="sky" geometry="primitive:sphere;radius:200" material="sunPosition:-0.9997454282845177 0.022562770756406943 -1;shader:sky;side:back" sun-position-setter="">
        <!--Position the sun-->
        <a-entity id="orbit" rotation="0 1.3301069669709749 0">
            <a-animation attribute="rotation" from="0 0 0" to="0 270 0" dur="100000" repeat="100"></a-animation>
        </a-entity>
    </a-entity>


    <!--pillars -->
    <a-cylinder position="121 5.096 -9.648" raidus="1" height="12" color="magenta"  ></a-cylinder>
    <a-cylinder position="118 5.096 16.214" radius="1"  height="12" color="magenta"></a-cylinder>


    <!-- banner -->
    <a-box color="tomato" position="118.987 9.805 2.878" rotation="0 0 0"  depth="24.5" height="5" width="2"></a-box>
    <a-text value="Welcome Back!" position="121.311 10.302 11.732" rotation="0 90 0"  width="60" color="#ff80c0">  </a-text>


    <a-obj-model src="coffee_table/100747_b.obj" mtl="coffee_table/100747_b.mtl" position="28 0 2" scale="0.1 0.1 0.1" material="" obj-model=""></a-obj-model>

    <!--plane-->
    <a-entity static-body="" geometry="depth:300;width:300;height:0.1" position="2.774 -1.035 7.582" material="shader:flat;side:double;src:images/ground.jpeg"></a-entity>



    <!-- Ceiling -->
    <a-entity static-body="" geometry="depth:50.08;height:0.1;width:160" position="0.398 13.546 4.911" material="repeat:20 12;shader:flat;side:double;src:images/wall.jpg"></a-entity>


    <!-- Floor -->
    <a-entity static-body="" geometry="depth:50;height:0.1;width:160" position="0 -0.5 5" material="shader:flat;side:double;src:images/floor.jpg;repeat:12 5"></a-entity>


    <a-entity static-body="" geometry="height:14;width:50" position="-80 6.5 5" rotation="0 90 0" material="roughness:1;src:images/wall.jpg;repeat:4 2"></a-entity>
    <a-entity static-body="" geometry="height:14;width:50" position="80 6.5 5" rotation="0 90 0" material="roughness:1;src:images/wall.jpg;repeat:4 2"></a-entity>
    <a-entity static-body="" geometry="height:14;width:160" position="0 6.5 -20" material="roughness:1;src:images/wall.jpg;repeat:12 2"></a-entity>
    <a-entity static-body="" geometry="height:14;width:160" position="0 6.5 30" material="roughness:1;src:images/wall.jpg;repeat:12 2"></a-entity>


    <!--light-->

    <a-light type="spot" color="#F5F5F5" position="-11.633 -1.319 69.044" light="type:ambient"></a-light>


</a-scene>

</body>
</html>
